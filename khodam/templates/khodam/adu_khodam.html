<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Adu Khodam</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gray-100">
    <div class="flex items-center justify-center min-h-screen">
      <div class="w-full max-w-4xl">
        <form
          action="{% url 'adu_khodam' %}"
          class="space-y-4 rounded-lg p-4 shadow-lg sm:p-6 lg:p-8 bg-white"
          method="post"
        >
          {% csrf_token %} {% comment %} Judul {% endcomment %}
          <h1
            class="text-center text-2xl font-bold text-indigo-600 sm:text-3xl"
          >
            Adu Khodam
          </h1>

          <div class="flex justify-between items-center">
            {% comment %} input kiri {% endcomment %}
            <div id="inputanKiri" class="w-1/2 pr-6">
              <label
                for="namaKiri"
                class="relative block rounded-md border border-gray-200 shadow-sm focus-within:border-blue-600 focus-within:ring-1 focus-within:ring-blue-600"
              >
                <input
                  type="text"
                  id="namaKiri"
                  name="namaKiri"
                  class="peer border-none bg-transparent placeholder-transparent focus:border-transparent focus:outline-none focus:ring-0 w-full rounded-lg border-gray-200 p-4 pe-12 text-sm shadow-sm text-center"
                  placeholder="Masukan Nama Khodam Kiri"
                  required
                />

                <span
                  class="pointer-events-none absolute left-2.5 top-0 -translate-y-1/2 bg-white p-0.5 text-xs text-gray-700 transition-all peer-placeholder-shown:top-1/2 peer-placeholder-shown:text-sm peer-focus:top-0 peer-focus:text-xs"
                >
                  Masukan Nama
                </span>
              </label>

              {% comment %} hasil khodam kiri {% endcomment %}
              <div class="mt-3" style="display: none" id="hasilKhodamKiri">
                <label
                  for="outkiri"
                  class="relative block rounded-md border border-gray-200 shadow-sm focus-within:border-blue-600 focus-within:ring-1 focus-within:ring-blue-600"
                >
                  <input
                    type="text"
                    id="khodamOutputKiri"
                    name="outkiri"
                    class="peer border-none bg-transparent placeholder-transparent focus:border-transparent focus:outline-none focus:ring-0 w-full rounded-lg border-gray-200 p-4 pe-12 text-sm shadow-sm text-center"
                    readonly
                  />
                </label>
              </div>
            </div>

            {% comment %} Tulisan "Vs" dan loading animation {% endcomment %}
            <div class="pr-3 pl-3">
              {% comment %} vs text {% endcomment %}
              <div
                id="vstext"
                class="text-center text-2xl font-bold text-indigo-600"
              >
                VS
              </div>

              {% comment %} loading animation {% endcomment %}
              <div class="pt-3 flex justify-center">
                <div id="loadingAnimation" style="display: none">
                  <div
                    class="p-2 bg-gradient-to-tr animate-spin from-green-500 to-blue-500 via-purple-500 rounded-full"
                  >
                    <div class="bg-white rounded-full">
                      <div class="w-8 h-8 rounded-full"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {% comment %} input kanan {% endcomment %}
            <div id="inputanKanan" class="w-1/2 pl-6">
              <label
                for="namaKanan"
                class="relative block rounded-md border border-gray-200 shadow-sm focus-within:border-blue-600 focus-within:ring-1 focus-within:ring-blue-600"
              >
                <input
                  type="text"
                  id="namaKanan"
                  name="namaKanan"
                  class="peer border-none bg-transparent placeholder-transparent focus:border-transparent focus:outline-none focus:ring-0 w-full rounded-lg border-gray-200 p-4 pe-12 text-sm shadow-sm text-center"
                  placeholder="Masukan Nama Khodam Kanan"
                  required
                />

                <span
                  class="pointer-events-none absolute left-2.5 top-0 -translate-y-1/2 bg-white p-0.5 text-xs text-gray-700 transition-all peer-placeholder-shown:top-1/2 peer-placeholder-shown:text-sm peer-focus:top-0 peer-focus:text-xs"
                >
                  Masukan Nama
                </span>
              </label>

              {% comment %} hasil khodam kanan {% endcomment %}
              <div class="mt-3" style="display: none" id="hasilKhodamKanan">
                <label
                  for="outkanan"
                  class="relative block rounded-md border border-gray-200 shadow-sm focus-within:border-blue-600 focus-within:ring-1 focus-within:ring-blue-600"
                >
                  <input
                    type="text"
                    id="khodamOutputKanan"
                    name="outkanan"
                    class="peer border-none bg-transparent placeholder-transparent focus:border-transparent focus:outline-none focus:ring-0 w-full rounded-lg border-gray-200 p-4 pe-12 text-sm shadow-sm text-center"
                    readonly
                  />
                </label>
              </div>
            </div>
          </div>

          {% comment %} button adu {% endcomment %}
          <div id="buttonAdu">
            <button
              type="submit"
              class="block w-full rounded-lg bg-indigo-600 px-5 py-3 text-sm font-medium text-white"
              id="cekButton"
              style="display: block"
            >
              Adu Khodam
            </button>
          </div>

          {% comment %} hasil {% endcomment %}
          <div id="result" style="display: none">
            <label
              for="pemenang"
              class="relative block rounded-md border border-gray-200 shadow-sm focus-within:border-blue-600 focus-within:ring-1 focus-within:ring-blue-600"
            >
              <input
                type="text"
                id="pemenang"
                name="pemenang"
                class="peer border-none bg-transparent placeholder-transparent focus:border-transparent focus:outline-none focus:ring-0 w-full rounded-lg border-gray-200 p-4 pe-12 text-sm shadow-sm text-center"
                readonly
              />
            </label>

            <!-- Tombol Kembali -->
            <button
              type="button"
              class="mt-4 block w-full rounded-lg bg-gray-600 px-5 py-3 text-sm font-medium text-white"
              id="backButton"
              onclick="window.location.reload();"
            >
              Reset
            </button>
          </div>

          <div class="mt-4 text-center">
            <a
              href="{% url 'index' %}"
              class="text-indigo-600 hover:text-indigo-500"
            >
              Kembali ke Halaman Cek Khodam
            </a>
          </div>
        </form>
      </div>
    </div>
  </body>
  <script>
    document
      .getElementById("cekButton")
      .addEventListener("click", function (e) {
        e.preventDefault();

        // Cek apakah nama khodam kiri dan kanan sudah diisi
        var namaKiri = document.getElementById("namaKiri").value;
        var namaKanan = document.getElementById("namaKanan").value;

        if (namaKiri === "" || namaKanan === "") {
          alert("Mohon isi nama khodam kiri dan kanan terlebih dahulu.");
          return;
        }

        document.getElementById("vstext").style.display = "none";
        document.getElementById("buttonAdu").style.display = "none";
        document.getElementById("loadingAnimation").style.display = "block";
        setTimeout(function() {
            var formData = new FormData(document.querySelector('form'));
            formData.append('csrfmiddlewaretoken',
            '{{ csrf_token }}');
            fetch('{% url 'adu_khodam' %}', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-CSRFToken': '{{ csrf_token }}'
                        }
                    })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    var khodamkanan = data.khodam_kanan;
                    var khodamkiri = data.khodam_kiri;
                    document.getElementById('khodamOutputKiri').value = "Khodam : " + khodamkiri;
                    document.getElementById('hasilKhodamKiri').style.display = 'block';
                    setTimeout(function() {
                        document.getElementById('khodamOutputKanan').value = "Khodam : " + khodamkanan;
                        document.getElementById('hasilKhodamKanan').style.display = 'block';
                    }, 1000);
                    setTimeout(function() {
                        if (data.pemenang === 'Seri') {
                            document.getElementById('pemenang').value = 'Seri sama sama kuat khodamnya';
                        } else {
                            document.getElementById('pemenang').value = 'Pemenangnya adalah ' + data.pemenang_nama + ' dengan khodam ' + data.pemenang_khodam;
                        }
                        document.getElementById('result').style.display = 'block';
                        document.getElementById('loadingAnimation').style.display = 'none';
                    }, 2000);


                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('vstext').style.display =
                    'block';
                })
                .finally(() => {

                });
        }, 2000);
      });
  </script>
</html>
